<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci칩n - Estad칤sticas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --azul-oscuro: #003366;
            --azul-claro: #3399CC;
            --rojo: #CC3333;
            --blanco: #FFFFFF;
            --gris-claro: #F5F5F5;
            --gris-medio: #DDDDDD;
            --gris-oscuro: #666666;
            --verde: #28a745;
            --naranja: #FF8C00;
            --morado: #6f42c1;
            --amarillo: #FFC107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gris-claro);
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .admin-header {
            background: linear-gradient(to right, var(--azul-oscuro), var(--azul-claro));
            color: var(--blanco);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--azul-claro);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--blanco);
        }
        
        .main-container {
            display: flex;
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }
        
        .admin-sidebar {
            width: 250px;
            background-color: var(--azul-oscuro);
            color: var(--blanco);
            border-radius: 10px;
            padding: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            height: fit-content;
        }
        
        .admin-welcome {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--azul-claro);
            margin-bottom: 15px;
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .menu-item:hover, .menu-item.active {
            background-color: var(--azul-claro);
            border-left: 4px solid var(--rojo);
        }
        
        .menu-item i {
            width: 25px;
            text-align: center;
        }
        
        .admin-content {
            flex: 1;
            margin-left: 20px;
        }
        
        .content-section {
            background-color: var(--blanco);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gris-medio);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--azul-oscuro);
            color: var(--blanco);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: var(--azul-claro);
        }
        
        .btn-primary {
            background-color: var(--azul-oscuro);
        }
        
        .btn-success {
            background-color: var(--verde);
        }
        
        .btn-danger {
            background-color: var(--rojo);
        }
        
        .btn-warning {
            background-color: var(--naranja);
        }
        
        .btn-purple {
            background-color: var(--morado);
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--gris-claro);
            border-radius: 8px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--azul-oscuro);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gris-medio);
            border-radius: 5px;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(to bottom right, var(--azul-oscuro), var(--azul-claro));
            color: var(--blanco);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-title {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--azul-oscuro);
            text-align: center;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .comparison-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .comparison-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gris-medio);
        }
        
        .comparison-value {
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .comparison-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            color: var(--gris-oscuro);
            font-size: 0.9rem;
        }
        
        .positive {
            color: var(--verde);
        }
        
        .negative {
            color: var(--rojo);
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gris-medio);
        }
        
        th {
            background-color: var(--azul-oscuro);
            color: var(--blanco);
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: var(--gris-claro);
        }
        
        .progress-bar {
            height: 8px;
            background-color: var(--gris-medio);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--verde);
            border-radius: 4px;
        }
        
        .progress-50 {
            width: 50%;
            background-color: var(--naranja);
        }
        
        .progress-75 {
            width: 75%;
            background-color: var(--azul-claro);
        }
        
        .progress-25 {
            width: 25%;
            background-color: var(--rojo);
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .notification-badge {
            background-color: var(--rojo);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .admin-content {
                margin-left: 0;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .comparison-cards {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-city fa-2x"></i>
                <h1>Panel de Administraci칩n</h1>
            </div>
            <div class="admin-actions">
                <div class="admin-info">
                    <div class="admin-avatar" id="admin-avatar">A</div>
                    <div>
                        <div>Administrador del Sistema</div>
                        <small id="correo-usuario">admin@alcaldiapasto.gov.co</small>
                    </div>
                </div>
                <a href="panel.html" class="btn btn-sm"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi칩n</a>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <div class="admin-sidebar">
            <div class="admin-welcome">
                <h3>Hola, Administrador</h3>
                <p>Bienvenido al panel de control</p>
            </div>
            <div class="menu-item" onclick="window.location.href='dashboard.html'">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="window.location.href='gestion-reportes.html'">
                <i class="fas fa-flag"></i>
                <span>Gesti칩n de Reportes</span>
                <span class="notification-badge" id="badge-reportes">12</span>
            </div>
            <div class="menu-item" onclick="window.location.href='gestion-usuarios.html'">
                <i class="fas fa-users"></i>
                <span>Gesti칩n de Usuarios</span>
                <span class="notification-badge" id="badge-usuarios">5</span>
            </div>
            <div class="menu-item" onclick="window.location.href='gestion-zonas.html'">
                <i class="fas fa-map-marked-alt"></i>
                <span>Gesti칩n de Zonas</span>
            </div>
            <div class="menu-item" onclick="window.location.href='asignaciones.html'">
                <i class="fas fa-tasks"></i>
                <span>Asignaciones</span>
                <span class="notification-badge" id="badge-asignaciones">8</span>
            </div>
            <div class="menu-item active">
                <i class="fas fa-chart-bar"></i>
                <span>Estad칤sticas</span>
            </div>
            <div class="menu-item" onclick="window.location.href='configuracion.html'">
                <i class="fas fa-cog"></i>
                <span>Configuraci칩n</span>
            </div>
        </div>
        
        <div class="admin-content">
            <div class="content-section active">
                <div class="dashboard-header">
                    <h2><i class="fas fa-chart-bar"></i> Estad칤sticas y Reportes</h2>
                    <div class="export-options">
                        <button class="btn btn-primary" id="export-pdf"><i class="fas fa-file-pdf"></i> PDF</button>
                        <button class="btn btn-success" id="export-excel"><i class="fas fa-file-excel"></i> Excel</button>
                    </div>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="rango-fechas">Rango de Fechas</label>
                        <select id="rango-fechas">
                            <option value="7">칔ltimos 7 d칤as</option>
                            <option value="30" selected>칔ltimos 30 d칤as</option>
                            <option value="90">칔ltimos 3 meses</option>
                            <option value="180">칔ltimos 6 meses</option>
                            <option value="365">칔ltimo a침o</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="filter-group" id="fecha-desde-group">
                        <label for="fecha-desde">Desde</label>
                        <input type="date" id="fecha-desde">
                    </div>
                    <div class="filter-group" id="fecha-hasta-group">
                        <label for="fecha-hasta">Hasta</label>
                        <input type="date" id="fecha-hasta">
                    </div>
                    <div class="filter-group">
                        <label for="categoria-estadistica">Categor칤a</label>
                        <select id="categoria-estadistica">
                            <option value="">Todas las categor칤as</option>
                            <option value="comercial">Ocupaci칩n comercial</option>
                            <option value="vehicular">Invasi칩n vehicular</option>
                            <option value="venta">Venta informal</option>
                            <option value="publicidad">Publicidad no autorizada</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" id="aplicar-filtros" style="width: 100%;">Aplicar Filtros</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-flag fa-2x"></i>
                        <div class="stat-number" id="total-reportes">0</div>
                        <div class="stat-title">Reportes Totales</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock fa-2x"></i>
                        <div class="stat-number" id="pendientes">0</div>
                        <div class="stat-title">Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-search fa-2x"></i>
                        <div class="stat-number" id="revision">0</div>
                        <div class="stat-title">En Revisi칩n</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle fa-2x"></i>
                        <div class="stat-number" id="resueltos">0</div>
                        <div class="stat-title">Resueltos</div>
                    </div>
                </div>
                
                <div class="comparison-cards">
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>Tasa de Resoluci칩n</h3>
                            <i class="fas fa-percentage" style="color: var(--azul-claro);"></i>
                        </div>
                        <div class="comparison-value" id="tasa-resolucion">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="barra-resolucion" style="width: 0%"></div>
                        </div>
                        <div class="comparison-footer">
                            <span>Meta: 80%</span>
                            <span class="positive" id="variacion-resolucion">+0% vs mes anterior</span>
                        </div>
                    </div>
                    
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>Tiempo Promedio Respuesta</h3>
                            <i class="fas fa-clock" style="color: var(--naranja);"></i>
                        </div>
                        <div class="comparison-value" id="tiempo-respuesta">0 <small>d칤as</small></div>
                        <div class="progress-bar">
                            <div class="progress-fill progress-50" id="barra-tiempo" style="width: 0%"></div>
                        </div>
                        <div class="comparison-footer">
                            <span>Meta: 1.5 d칤as</span>
                            <span class="negative" id="variacion-tiempo">+0 vs mes anterior</span>
                        </div>
                    </div>
                    
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h3>Eficiencia por Funcionario</h3>
                            <i class="fas fa-user-check" style="color: var(--verde);"></i>
                        </div>
                        <div class="comparison-value" id="eficiencia-funcionario">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="barra-eficiencia" style="width: 0%"></div>
                        </div>
                        <div class="comparison-footer">
                            <span>Meta: 85%</span>
                            <span class="positive" id="variacion-eficiencia">+0% vs mes anterior</span>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">Reportes por Categor칤a</div>
                        <div class="chart-wrapper">
                            <canvas id="categoriaChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">Evoluci칩n Mensual de Reportes</div>
                        <div class="chart-wrapper">
                            <canvas id="evolucionChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">Distribuci칩n por Zonas</div>
                        <div class="chart-wrapper">
                            <canvas id="zonasChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">Estado de Asignaciones</div>
                        <div class="chart-wrapper">
                            <canvas id="asignacionesChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-header">
                    <h3>Top 5 Funcionarios por Eficiencia</h3>
                </div>
                
                <div class="table-container">
                    <table id="tabla-funcionarios">
                        <thead>
                            <tr>
                                <th>Funcionario</th>
                                <th>Reportes Asignados</th>
                                <th>Completados</th>
                                <th>Tasa de 칄xito</th>
                                <th>Tiempo Promedio</th>
                                <th>Calificaci칩n</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpo-tabla-funcionarios">
                            <tr>
                                <td colspan="6" style="text-align: center;">Cargando datos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Configuraci칩n de Supabase
        const supabaseUrl = "https://okulnfrlydegkyujpssj.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rdWxuZnJseWRlZ2t5dWpwc3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODg2MjAsImV4cCI6MjA3NDY2NDYyMH0.j0vsvYfpOu0EcbtjGGVgJBCwp1LvWeLiKDALjmdFo4o";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // Variables globales para los gr치ficos
        let categoriaChart, evolucionChart, zonasChart, asignacionesChart;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si el usuario est치 autenticado
            const correoGuardado = localStorage.getItem("usuarioEmail");
            if (correoGuardado) {
                document.getElementById("correo-usuario").textContent = correoGuardado;
                document.getElementById("admin-avatar").textContent = correoGuardado.charAt(0).toUpperCase();
            } else {
                // Si no hay correo guardado, redirigir al login
                window.location.href = "panel.html";
                return;
            }
            
            // Configurar fechas por defecto
            const today = new Date();
            const lastMonth = new Date();
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            
            document.getElementById('fecha-desde').value = formatDate(lastMonth);
            document.getElementById('fecha-hasta').value = formatDate(today);
            
            // Configurar badges con valores fijos seg칰n especificaci칩n
            document.getElementById('badge-reportes').textContent = '12';
            document.getElementById('badge-usuarios').textContent = '5';
            document.getElementById('badge-asignaciones').textContent = '8';
            
            // Cargar datos iniciales
            cargarDatosDesdeSupabase();
            
            // Configurar eventos de filtros
            document.getElementById('rango-fechas').addEventListener('change', function() {
                const customDatesGroup = document.getElementById('fecha-desde-group');
                const customDatesGroup2 = document.getElementById('fecha-hasta-group');
                
                if (this.value === 'custom') {
                    customDatesGroup.style.display = 'block';
                    customDatesGroup2.style.display = 'block';
                } else {
                    customDatesGroup.style.display = 'none';
                    customDatesGroup2.style.display = 'none';
                    
                    // Establecer fechas autom치ticamente seg칰n el rango seleccionado
                    const endDate = new Date();
                    const startDate = new Date();
                    
                    startDate.setDate(startDate.getDate() - parseInt(this.value));
                    
                    document.getElementById('fecha-desde').value = formatDate(startDate);
                    document.getElementById('fecha-hasta').value = formatDate(endDate);
                }
            });
            
            document.getElementById('aplicar-filtros').addEventListener('click', function() {
                cargarDatosDesdeSupabase();
            });
            
            // Ocultar los selectores de fecha personalizada inicialmente
            document.getElementById('fecha-desde-group').style.display = 'none';
            document.getElementById('fecha-hasta-group').style.display = 'none';
            
            // Configurar eventos de exportaci칩n
            document.getElementById('export-pdf').addEventListener('click', function() {
                alert('Funcionalidad de exportaci칩n a PDF en desarrollo');
            });
            
            document.getElementById('export-excel').addEventListener('click', function() {
                alert('Funcionalidad de exportaci칩n a Excel en desarrollo');
            });
        });
        
        async function cargarDatosDesdeSupabase() {
            try {
                // Obtener filtros
                const fechaDesde = document.getElementById('fecha-desde').value;
                const fechaHasta = document.getElementById('fecha-hasta').value;
                const categoria = document.getElementById('categoria-estadistica').value;
                
                // Construir consulta
                let query = supabase.from('denuncias').select('*');
                
                // Aplicar filtros de fecha si est치n disponibles
                if (fechaDesde && fechaHasta) {
                    query = query.gte('creado_en', fechaDesde).lte('creado_en', fechaHasta);
                }
                
                // Aplicar filtro de categor칤a si est치 seleccionada
                if (categoria) {
                    query = query.eq('categoria', categoria);
                }
                
                const { data: reportes, error } = await query;
                if (error) throw error;
                
                console.log("游늵 Datos obtenidos para estad칤sticas:", reportes);
                
                // Actualizar estad칤sticas
                actualizarEstadisticas(reportes);
                
                // Actualizar gr치ficos
                actualizarGraficos(reportes);
                
                // Actualizar tabla de funcionarios
                actualizarTablaFuncionarios(reportes);
                
            } catch (e) {
                console.error("Error obteniendo datos de Supabase:", e.message);
            }
        }
        
        function actualizarEstadisticas(reportes) {
            // Contadores b치sicos
            const total = reportes.length;
            const pendientes = reportes.filter(r => r.estado === 'Pendiente').length;
            const revision = reportes.filter(r => r.estado === 'Revision').length;
            const resueltos = reportes.filter(r => r.estado === 'Resuelto').length;
            
            // Actualizar tarjetas de estad칤sticas
            document.getElementById('total-reportes').textContent = total;
            document.getElementById('pendientes').textContent = pendientes;
            document.getElementById('revision').textContent = revision;
            document.getElementById('resueltos').textContent = resueltos;
            
            // Calcular m칠tricas avanzadas
            const tasaResolucion = total > 0 ? Math.round((resueltos / total) * 100) : 0;
            const tiempoRespuesta = calcularTiempoPromedioRespuesta(reportes);
            const eficienciaFuncionario = calcularEficienciaFuncionario(reportes);
            
            // Actualizar tarjetas de comparaci칩n
            document.getElementById('tasa-resolucion').textContent = `${tasaResolucion}%`;
            document.getElementById('barra-resolucion').style.width = `${tasaResolucion}%`;
            
            document.getElementById('tiempo-respuesta').textContent = tiempoRespuesta.toFixed(1);
            const porcentajeTiempo = Math.min(100, (tiempoRespuesta / 4) * 100); // Asumiendo 4 d칤as como m치ximo
            document.getElementById('barra-tiempo').style.width = `${porcentajeTiempo}%`;
            
            document.getElementById('eficiencia-funcionario').textContent = `${eficienciaFuncionario}%`;
            document.getElementById('barra-eficiencia').style.width = `${eficienciaFuncionario}%`;
        }
        
        function calcularTiempoPromedioRespuesta(reportes) {
            // Simulaci칩n: calcular tiempo promedio de respuesta
            // En una implementaci칩n real, esto usar칤a fechas de creaci칩n y resoluci칩n
            const reportesResueltos = reportes.filter(r => r.estado === 'Resuelto');
            if (reportesResueltos.length === 0) return 0;
            
            // Simulaci칩n: tiempo aleatorio entre 0.5 y 5 d칤as
            return reportesResueltos.reduce((sum, reporte) => {
                return sum + (0.5 + Math.random() * 4.5);
            }, 0) / reportesResueltos.length;
        }
        
        function calcularEficienciaFuncionario(reportes) {
            // Simulaci칩n: calcular eficiencia promedio de funcionarios
            if (reportes.length === 0) return 0;
            
            // Simulaci칩n: eficiencia aleatoria entre 70% y 95%
            return Math.floor(70 + Math.random() * 25);
        }
        
        function actualizarGraficos(reportes) {
            // Datos para gr치fico de categor칤as
            const categorias = ['Ocupaci칩n comercial', 'Invasi칩n vehicular', 'Venta informal', 'Publicidad no autorizada', 'Otros'];
            const datosCategorias = categorias.map(cat => 
                reportes.filter(r => r.categoria === cat).length
            );
            
            // Datos para gr치fico de evoluci칩n (simulado)
            const meses = ['Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep'];
            const datosEvolucion = meses.map(() => Math.floor(Math.random() * 50) + 20);
            const datosResueltos = datosEvolucion.map(val => Math.floor(val * 0.7));
            
            // Datos para gr치fico de zonas (simulado)
            const zonas = ['Centro', 'Norte', 'Sur', 'Este', 'Oeste'];
            const datosZonas = zonas.map(() => Math.floor(Math.random() * 30) + 10);
            
            // Datos para gr치fico de asignaciones
            const estados = ['Completadas', 'En Proceso', 'Pendientes', 'Atrasadas'];
            const datosAsignaciones = [
                reportes.filter(r => r.estado === 'Resuelto').length,
                reportes.filter(r => r.estado === 'Revision').length,
                reportes.filter(r => r.estado === 'Pendiente').length,
                Math.floor(reportes.length * 0.1) // Simulaci칩n de atrasados
            ];
            
            // Destruir gr치ficos existentes si existen
            if (categoriaChart) categoriaChart.destroy();
            if (evolucionChart) evolucionChart.destroy();
            if (zonasChart) zonasChart.destroy();
            if (asignacionesChart) asignacionesChart.destroy();
            
            // Gr치fico de categor칤as
            const categoriaCtx = document.getElementById('categoriaChart').getContext('2d');
            categoriaChart = new Chart(categoriaCtx, {
                type: 'doughnut',
                data: {
                    labels: categorias,
                    datasets: [{
                        data: datosCategorias,
                        backgroundColor: [
                            '#003366',
                            '#3399CC',
                            '#28a745',
                            '#FF8C00',
                            '#6f42c1'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Gr치fico de evoluci칩n
            const evolucionCtx = document.getElementById('evolucionChart').getContext('2d');
            evolucionChart = new Chart(evolucionCtx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Reportes Recibidos',
                        data: datosEvolucion,
                        borderColor: '#003366',
                        backgroundColor: 'rgba(0, 51, 102, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Reportes Resueltos',
                        data: datosResueltos,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gr치fico de zonas
            const zonasCtx = document.getElementById('zonasChart').getContext('2d');
            zonasChart = new Chart(zonasCtx, {
                type: 'bar',
                data: {
                    labels: zonas,
                    datasets: [{
                        label: 'Reportes por Zona',
                        data: datosZonas,
                        backgroundColor: '#3399CC',
                        borderColor: '#003366',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gr치fico de asignaciones
            const asignacionesCtx = document.getElementById('asignacionesChart').getContext('2d');
            asignacionesChart = new Chart(asignacionesCtx, {
                type: 'polarArea',
                data: {
                    labels: estados,
                    datasets: [{
                        data: datosAsignaciones,
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(0, 51, 102, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(204, 51, 51, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }
        
        function actualizarTablaFuncionarios(reportes) {
            // Simulaci칩n de datos de funcionarios
            const funcionarios = [
                { nombre: 'Mar칤a Gonz치lez', asignados: 24, completados: 22, tiempo: 1.8, calificacion: 4.8 },
                { nombre: 'Carlos Rodr칤guez', asignados: 32, completados: 28, tiempo: 2.1, calificacion: 4.6 },
                { nombre: 'Ana Mart칤nez', asignados: 18, completados: 15, tiempo: 2.3, calificacion: 4.5 },
                { nombre: 'Javier L칩pez', asignados: 20, completados: 16, tiempo: 2.7, calificacion: 4.2 },
                { nombre: 'Luis Fern치ndez', asignados: 15, completados: 12, tiempo: 2.9, calificacion: 4.0 }
            ];
            
            const cuerpoTabla = document.getElementById('cuerpo-tabla-funcionarios');
            cuerpoTabla.innerHTML = funcionarios.map(func => `
                <tr>
                    <td>${func.nombre}</td>
                    <td>${func.asignados}</td>
                    <td>${func.completados}</td>
                    <td>${((func.completados / func.asignados) * 100).toFixed(1)}%</td>
                    <td>${func.tiempo} d칤as</td>
                    <td>${func.calificacion}/5</td>
                </tr>
            `).join('');
        }
        
        // Funci칩n para formatear fechas como YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
    </script>
</body>
</html>