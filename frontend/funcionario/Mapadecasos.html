<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Casos - Sistema de Reportes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --azul-oscuro: #003366;
            --azul-claro: #3399CC;
            --rojo: #CC3333;
            --blanco: #FFFFFF;
            --gris-claro: #F5F5F5;
            --gris-medio: #DDDDDD;
            --gris-oscuro: #666666;
            --verde: #28a745;
            --naranja: #fd7e14;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gris-claro);
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .func-header {
            background: linear-gradient(to right, var(--azul-oscuro), var(--azul-claro));
            color: var(--blanco);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .func-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .func-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .func-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--azul-claro);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--blanco);
        }
        
        .main-container {
            display: flex;
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }
        
        .func-sidebar {
            width: 250px;
            background-color: var(--azul-oscuro);
            color: var(--blanco);
            border-radius: 10px;
            padding: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            height: fit-content;
        }
        
        .func-welcome {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--azul-claro);
            margin-bottom: 15px;
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .menu-item:hover, .menu-item.active {
            background-color: var(--azul-claro);
            border-left: 4px solid var(--rojo);
        }
        
        .menu-item i {
            width: 25px;
            text-align: center;
        }
        
        .notification-badge {
            background-color: var(--rojo);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: auto;
        }
        
        .func-content {
            flex: 1;
            margin-left: 20px;
        }
        
        .content-section {
            background-color: var(--blanco);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gris-medio);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--azul-claro);
            color: var(--blanco);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--azul-oscuro);
        }
        
        .btn-primary:hover {
            background-color: var(--azul-claro);
        }
        
        .btn-success {
            background-color: var(--verde);
        }
        
        .btn-warning {
            background-color: var(--naranja);
        }
        
        .btn-danger {
            background-color: var(--rojo);
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .map-container {
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        #mapa-interactivo {
            height: 100%;
            width: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .map-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .legend-priority-alta {
            background-color: var(--rojo);
        }
        
        .legend-priority-media {
            background-color: var(--naranja);
        }
        
        .legend-priority-baja {
            background-color: var(--verde);
        }
        
        .map-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--gris-claro);
            border-radius: 8px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--azul-oscuro);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gris-medio);
            border-radius: 5px;
            font-size: 16px;
        }
        
        .casos-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(to bottom right, var(--azul-oscuro), var(--azul-claro));
            color: var(--blanco);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-title {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .func-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .func-content {
                margin-left: 0;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .map-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header class="func-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-city fa-2x"></i>
                <h1>Panel de Funcionario</h1>
            </div>
            <div class="func-actions">
                <div class="func-info">
                    <div class="func-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">Usuario</div>
                        <small id="userEmail">correo@ejemplo.com</small>
                    </div>
                </div>
                <a href="#" class="btn btn-sm" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</a>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <div class="func-sidebar">
            <div class="func-welcome">
                <h3 id="welcomeName">Hola, Usuario</h3>
                <p>Bienvenido al panel de funcionario</p>
            </div>
            <div class="menu-item" data-target="dashboard" onclick="window.location.href='funcionarios.html'">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>

            <div class="menu-item" data-target="casos" onclick="window.location.href='Miscasos.html'">
                <i class="fas fa-tasks"></i>
                <span>Mis Casos</span>
            </div>

            <div class="menu-item" data-target="asignados" onclick="window.location.href='casosasignados.html'">
                <i class="fas fa-clipboard-list"></i>
                <span>Casos Asignados</span>
                <span class="notification-badge">5</span>
            </div>

            <div class="menu-item" data-target="nuevos" onclick="window.location.href='Nuevosreportes.html'">
                <i class="fas fa-flag"></i>
                <span>Nuevos Reportes</span>
                <span class="notification-badge">3</span>
            </div>

            <div class="menu-item active" data-target="mapa" onclick="window.location.href='Mapadecasos.html'">
                <i class="fas fa-map-marked-alt"></i>
                <span>Mapa de Casos</span>
            </div>

            <div class="menu-item" data-target="perfil" onclick="window.location.href='Miperfil.html'">
                <i class="fas fa-user-cog"></i>
                <span>Mi Perfil</span>
            </div>
        </div>
        
        <div class="func-content">
            <!-- MAPA DE CASOS -->
            <div class="content-section active" id="mapa">
                <div class="dashboard-header">
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa de Casos</h2>
                    <button class="btn btn-primary" id="btn-actualizar-mapa"><i class="fas fa-sync-alt"></i> Actualizar</button>
                </div>
                
                <div class="casos-stats">
                    <div class="stat-card">
                        <i class="fas fa-map-marker-alt fa-2x"></i>
                        <div class="stat-number" id="total-casos-mapa">0</div>
                        <div class="stat-title">Casos en el Mapa</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-exclamation-circle fa-2x"></i>
                        <div class="stat-number" id="casos-prioridad-alta">0</div>
                        <div class="stat-title">Prioridad Alta</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock fa-2x"></i>
                        <div class="stat-number" id="casos-pendientes">0</div>
                        <div class="stat-title">Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle fa-2x"></i>
                        <div class="stat-number" id="casos-resueltos">0</div>
                        <div class="stat-title">Resueltos</div>
                    </div>
                </div>
                
                <div class="map-filters">
                    <div class="filter-group">
                        <label for="filtro-categoria-mapa">Categor√≠a</label>
                        <select id="filtro-categoria-mapa">
                            <option value="">Todas las categor√≠as</option>
                            <option value="venta">Venta informal</option>
                            <option value="ocupacion">Ocupaci√≥n comercial</option>
                            <option value="invasion">Invasi√≥n vehicular</option>
                            <option value="publicidad">Publicidad no autorizada</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filtro-prioridad-mapa">Prioridad</label>
                        <select id="filtro-prioridad-mapa">
                            <option value="">Todas las prioridades</option>
                            <option value="alta">Alta</option>
                            <option value="media">Media</option>
                            <option value="baja">Baja</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filtro-estado-mapa">Estado</label>
                        <select id="filtro-estado-mapa">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="revision">En revisi√≥n</option>
                            <option value="resuelto">Resuelto</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filtro-zona-mapa">Zona</label>
                        <select id="filtro-zona-mapa">
                            <option value="">Todas las zonas</option>
                            <option value="centro">Centro</option>
                            <option value="norte">Norte</option>
                            <option value="sur">Sur</option>
                            <option value="oriente">Oriente</option>
                            <option value="occidente">Occidente</option>
                        </select>
                    </div>
                </div>
                
                <div class="map-container">
                    <div id="mapa-interactivo">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Cargando mapa...
                        </div>
                    </div>
                    
                    <div class="map-controls">
                        <button class="btn btn-sm btn-primary" id="btn-centrar-mapa">
                            <i class="fas fa-crosshairs"></i> Centrar
                        </button>
                        <button class="btn btn-sm" id="btn-mi-ubicacion">
                            <i class="fas fa-location-arrow"></i> Mi ubicaci√≥n
                        </button>
                        <button class="btn btn-sm" id="btn-cambiar-vista">
                            <i class="fas fa-layer-group"></i> Vista sat√©lite
                        </button>
                    </div>
                    
                    <div class="map-legend">
                        <h4>Leyenda</h4>
                        <div class="legend-item">
                            <div class="legend-color legend-priority-alta"></div>
                            <span>Prioridad Alta</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-priority-media"></div>
                            <span>Prioridad Media</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-priority-baja"></div>
                            <span>Prioridad Baja</span>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="btn-exportar-mapa"><i class="fas fa-download"></i> Exportar Mapa</button>
                    <button class="btn" id="btn-imprimir-mapa"><i class="fas fa-print"></i> Imprimir Vista</button>
                    <button class="btn btn-success" id="btn-nuevo-reporte"><i class="fas fa-plus"></i> Nuevo Reporte desde Mapa</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n directa de Supabase
        const SUPABASE_URL = 'https://okulnfrlydegkyujpssj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rdWxuZnJseWRlZ2t5dWpwc3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODg2MjAsImV4cCI6MjA3NDY2NDYyMH0.j0vsvYfpOu0EcbtjGGVgJBCwp1LvWeLiKDALjmdFo4o';
        
        // Crear cliente Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log('üîç Iniciando Mapadecasos.html...');
        
        // Variables globales
        let mapa;
        let marcadores = [];
        let capaActual = 'street';
        let miUbicacion = null;

        // FUNCI√ìN DE LOGOUT - VERSI√ìN MEJORADA
        function handleLogout(e) {
            if (e) e.preventDefault();
            
            console.log('üö™ EJECUTANDO LOGOUT...');
            
            // Mostrar confirmaci√≥n
            if (!confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                return false;
            }
            
            // Limpiar TODO el localStorage
            localStorage.removeItem('funcionario');
            localStorage.removeItem('user');
            sessionStorage.clear();
            
            console.log('‚úÖ Datos eliminados, redirigiendo...');
            
            // Redirigir inmediatamente
            window.location.href = 'login.html?logout=' + Date.now();
            return false;
        }

        // Configurar eventos cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß DOM cargado, configurando eventos...');
            
            // CONFIGURAR BOT√ìN DE LOGOUT
            const logoutBtn = document.getElementById('logoutBtn');
            console.log('üìç Bot√≥n de logout:', logoutBtn);
            
            if (logoutBtn) {
                logoutBtn.onclick = handleLogout;
                console.log('‚úÖ Evento de logout configurado');
            } else {
                console.error('‚ùå NO SE ENCUENTRA EL BOT√ìN logoutBtn');
            }

            // Configurar botones del mapa
            document.getElementById('btn-actualizar-mapa').addEventListener('click', function() {
                verificarAutenticacion();
            });

            document.getElementById('btn-centrar-mapa').addEventListener('click', centrarMapa);
            document.getElementById('btn-mi-ubicacion').addEventListener('click', obtenerMiUbicacion);
            document.getElementById('btn-cambiar-vista').addEventListener('click', cambiarVistaMapa);
            document.getElementById('btn-exportar-mapa').addEventListener('click', exportarMapa);
            document.getElementById('btn-imprimir-mapa').addEventListener('click', imprimirMapa);
            document.getElementById('btn-nuevo-reporte').addEventListener('click', nuevoReporteDesdeMapa);

            // Configurar filtros
            document.getElementById('filtro-categoria-mapa').addEventListener('change', filtrarMapa);
            document.getElementById('filtro-prioridad-mapa').addEventListener('change', filtrarMapa);
            document.getElementById('filtro-estado-mapa').addEventListener('change', filtrarMapa);
            document.getElementById('filtro-zona-mapa').addEventListener('change', filtrarMapa);

            // Inicializar mapa y verificar autenticaci√≥n
            inicializarMapa();
            verificarAutenticacion();
        });

        // Inicializar mapa
        function inicializarMapa() {
            console.log('üó∫Ô∏è Inicializando mapa...');
            
            // Coordenadas de Pasto, Colombia
            const centroPasto = [1.2136, -77.2811];
            
            // Crear mapa
            mapa = L.map('mapa-interactivo').setView(centroPasto, 13);
            
            // Capas base
            const capaCalles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            });
            
            const capaSatelite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            });
            
            // Agregar capa por defecto
            capaCalles.addTo(mapa);
            
            console.log('‚úÖ Mapa inicializado correctamente');
        }

        // Funci√≥n para verificar autenticaci√≥n
        async function verificarAutenticacion() {
            console.log('üîê Verificando autenticaci√≥n...');
            const funcionarioData = localStorage.getItem('funcionario');
            console.log('üìã Datos de funcionario:', funcionarioData);
            
            if (!funcionarioData) {
                console.log('‚ùå No autenticado, redirigiendo a login.html');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const user = JSON.parse(funcionarioData);
                console.log('‚úÖ Usuario autenticado:', user.nombre);
                
                // Actualizar informaci√≥n del usuario
                document.getElementById('userName').textContent = user.nombre;
                document.getElementById('userEmail').textContent = user.correo;
                document.getElementById('welcomeName').textContent = `Hola, ${user.nombre.split(' ')[0]}`;
                document.getElementById('userAvatar').textContent = user.nombre.charAt(0);
                
                // Cargar datos del mapa
                await cargarCasosEnMapa();
                
            } catch (error) {
                console.error('‚ùå Error al parsear datos:', error);
                localStorage.removeItem('funcionario');
                window.location.href = 'login.html';
            }
        }

        // Cargar casos en el mapa
        async function cargarCasosEnMapa() {
            try {
                console.log('üîÑ Cargando casos para el mapa...');
                
                const { data: denuncias, error } = await supabase
                    .from('denuncias')
                    .select('*')
                    .order('fecha_creacion', { ascending: false });
                
                if (error) throw error;
                
                console.log('üìã Casos encontrados:', denuncias ? denuncias.length : 0);
                
                // Limpiar marcadores existentes
                limpiarMarcadores();
                
                // Mostrar casos en el mapa
                mostrarCasosEnMapa(denuncias);
                
                // Actualizar estad√≠sticas
                actualizarEstadisticas(denuncias);
                
            } catch (error) {
                console.error('‚ùå Error cargando casos para el mapa:', error);
                alert('Error al cargar los casos en el mapa');
            }
        }

        // Mostrar casos en el mapa
        function mostrarCasosEnMapa(casos) {
            if (!casos || casos.length === 0) {
                console.log('üì≠ No hay casos para mostrar en el mapa');
                return;
            }
            
            casos.forEach(caso => {
                // Generar coordenadas aleatorias alrededor de Pasto si no hay coordenadas
                const lat = caso.latitud || (1.2136 + (Math.random() - 0.5) * 0.05);
                const lng = caso.longitud || (-77.2811 + (Math.random() - 0.5) * 0.05);
                
                // Determinar color seg√∫n prioridad
                let color = 'green';
                if (caso.prioridad === 'alta') color = 'red';
                else if (caso.prioridad === 'media') color = 'orange';
                
                // Crear marcador
                const marcador = L.circleMarker([lat, lng], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.7,
                    radius: 8
                }).addTo(mapa);
                
                // Contenido del popup
                const popupContent = `
                    <div style="min-width: 200px;">
                        <h4>${caso.titulo || 'Caso sin t√≠tulo'}</h4>
                        <p><strong>ID:</strong> ${caso.id || 'N/A'}</p>
                        <p><strong>Categor√≠a:</strong> ${caso.categoria || 'Sin categor√≠a'}</p>
                        <p><strong>Prioridad:</strong> ${caso.prioridad || 'No especificada'}</p>
                        <p><strong>Estado:</strong> ${caso.estado || 'Pendiente'}</p>
                        <p><strong>Ubicaci√≥n:</strong> ${caso.ubicacion || 'Ubicaci√≥n no especificada'}</p>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-sm btn-primary" onclick="verDetallesCaso('${caso.id}')">
                                <i class="fas fa-eye"></i> Ver Detalles
                            </button>
                        </div>
                    </div>
                `;
                
                marcador.bindPopup(pupupContent);
                marcadores.push(marcador);
                
                // Agregar datos del caso al marcador para filtrado
                marcador.casoData = caso;
            });
            
            console.log(`‚úÖ ${marcadores.length} marcadores agregados al mapa`);
        }

        // Limpiar marcadores del mapa
        function limpiarMarcadores() {
            marcadores.forEach(marcador => {
                mapa.removeLayer(marcador);
            });
            marcadores = [];
            console.log('üßπ Marcadores limpiados del mapa');
        }

        // Actualizar estad√≠sticas
        function actualizarEstadisticas(casos) {
            if (!casos) return;
            
            const total = casos.length;
            const prioridadAlta = casos.filter(c => c.prioridad === 'alta').length;
            const pendientes = casos.filter(c => c.estado === 'pendiente').length;
            const resueltos = casos.filter(c => c.estado === 'resuelto').length;
            
            document.getElementById('total-casos-mapa').textContent = total;
            document.getElementById('casos-prioridad-alta').textContent = prioridadAlta;
            document.getElementById('casos-pendientes').textContent = pendientes;
            document.getElementById('casos-resueltos').textContent = resueltos;
            
            console.log('üìä Estad√≠sticas actualizadas');
        }

        // Funciones de control del mapa
        function centrarMapa() {
            mapa.setView([1.2136, -77.2811], 13);
            console.log('üìç Mapa centrado en Pasto');
        }

        function obtenerMiUbicacion() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        miUbicacion = L.marker([lat, lng])
                            .addTo(mapa)
                            .bindPopup('Mi ubicaci√≥n actual')
                            .openPopup();
                        
                        mapa.setView([lat, lng], 15);
                        console.log('üìç Mi ubicaci√≥n encontrada:', lat, lng);
                    },
                    function(error) {
                        console.error('‚ùå Error obteniendo ubicaci√≥n:', error);
                        alert('No se pudo obtener tu ubicaci√≥n');
                    }
                );
            } else {
                alert('La geolocalizaci√≥n no es soportada por este navegador');
            }
        }

        function cambiarVistaMapa() {
            // Esta funci√≥n alternar√≠a entre vista de calles y sat√©lite
            // Por simplicidad, solo mostramos un mensaje
            const btn = document.getElementById('btn-cambiar-vista');
            if (capaActual === 'street') {
                capaActual = 'satellite';
                btn.innerHTML = '<i class="fas fa-layer-group"></i> Vista calles';
            } else {
                capaActual = 'street';
                btn.innerHTML = '<i class="fas fa-layer-group"></i> Vista sat√©lite';
            }
            console.log('üîÑ Cambiando vista del mapa a:', capaActual);
        }

        function filtrarMapa() {
            console.log('üîç Aplicando filtros al mapa...');
            // En una implementaci√≥n completa, aqu√≠ se filtrar√≠an los marcadores
            // seg√∫n los valores de los filtros
        }

        function exportarMapa() {
            console.log('üíæ Exportando mapa...');
            alert('Funcionalidad de exportaci√≥n en desarrollo');
        }

        function imprimirMapa() {
            console.log('üñ®Ô∏è Imprimiendo mapa...');
            window.print();
        }

        function nuevoReporteDesdeMapa() {
            console.log('‚ûï Creando nuevo reporte desde mapa...');
            alert('Funcionalidad de nuevo reporte desde mapa en desarrollo');
        }

        // Ver detalles del caso (similar a la funci√≥n en casosasignados.html)
        function verDetallesCaso(casoId) {
            console.log('üîç Viendo detalles del caso:', casoId);
            // Aqu√≠ podr√≠as abrir un modal con los detalles del caso
            alert(`Ver detalles del caso ${casoId} - Funcionalidad en desarrollo`);
        }
    </script>
</body>
</html>